<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ptLasso">
<title>Multi-response data with mixed response types (glmnet only) • ptLasso</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multi-response data with mixed response types (glmnet only)">
<meta property="og:description" content="ptLasso">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ptLasso</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ptLasso.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/InputGroupedData.html">Input grouped data</a>
    <a class="dropdown-item" href="../articles/LearningTheInputGroups.html">Learning the input groups</a>
    <a class="dropdown-item" href="../articles/DifferentGroupsTrainAndTest.html">Different groups in train and test data</a>
    <a class="dropdown-item" href="../articles/TargetGroupedData.html">Target grouped (multinomial response) data</a>
    <a class="dropdown-item" href="../articles/MultiResponseGaussian.html">Multi-response data with Gaussian responses</a>
    <a class="dropdown-item" href="../articles/TimeSeriesData.html">Time series data</a>
    <a class="dropdown-item" href="../articles/MultiResponseMixed.html">Multi-response data with mixed response types</a>
    <a class="dropdown-item" href="../articles/ConditionalAverageTreatmentEffect.html">Conditional average treatment effects</a>
    <a class="dropdown-item" href="../articles/UsingNonlinearBases.html">Pretraining with nonlinear bases</a>
    <a class="dropdown-item" href="../articles/UnsupervisedPretraining.html">Unsupervised pretraining</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Multi-response data with mixed response types (glmnet only)</h1>
            
      
      
      <div class="d-none name"><code>MultiResponseMixed.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: glmnet</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="co">#&gt; Loaded glmnet 4.1-8</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: survival</span></span></code></pre></div>
<p>Muti-response data consists of datasets with covariates <span class="math inline">\(X\)</span> and multiple outcomes <span class="math inline">\(y_1, y_2, y_3, \dots\)</span>. If these outcomes
are all continuous, then it may be natural to treat this as a multitask
learning problem (see the section “Multi-response data with Gaussian
responses”). If the outcomes have mixed types however – e.g. <span class="math inline">\(y_1\)</span> is continuous, <span class="math inline">\(y_2\)</span> binary and <span class="math inline">\(y_3\)</span> survival – then the problem is
slightly more challenging, because there are fewer methods developed for
this setting.</p>
<p>Pretraining is a natural fit for this task: we often believe that
there is shared information between <span class="math inline">\(y_1\)</span>, <span class="math inline">\(y_2\)</span> and <span class="math inline">\(y_3\)</span>. If we fit 3 separate models, we
never get to take advantage of any shared information; further, because
the outcomes have different types, there are very few methods to fit
<em>one</em> model for all outcomes (an “overall model”).</p>
<p>So, we will use pretraining to pass information between models. Our
plan is similar to the time series example; we will:</p>
<ol style="list-style-type: decimal">
<li>fit a model for <span class="math inline">\(y_1\)</span>,</li>
<li>extract the offset and support from this model,</li>
<li>use the offset and support (the usual pretraining) to train models
for <span class="math inline">\(y_2\)</span> and <span class="math inline">\(y_3\)</span>.</li>
</ol>
<p>There is one small detail here: we must choose the primary outcome
<span class="math inline">\(y_1\)</span>. This is an important choice
because it will form the support and offset for the other two outcomes.
We recommend making this selection using domain knowledge, but
cross-validation (or a validation set) can of course be used.</p>
<p>Here, we walk through an example with simulated data with three
outcomes <span class="math inline">\(y_1, y_2\)</span> and <span class="math inline">\(y_3\)</span>. The three outcomes have overlapping
support; the first 10 features are predictive . Outcomes 2 and 3
additionally have 5 features unique to each of them. We’ll define <span class="math inline">\(y_1\)</span> to be continuous, <span class="math inline">\(y_2\)</span> to be binomial and <span class="math inline">\(y_3\)</span> to be survival.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define constants</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">600</span>          <span class="co"># Total number of samples</span></span>
<span><span class="va">ntrain</span> <span class="op">=</span> <span class="fl">300</span>     <span class="co"># Number of training samples</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fl">50</span>           <span class="co"># Number of features</span></span>
<span></span>
<span><span class="co"># Define covariates     </span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># y1: continuous response</span></span>
<span><span class="va">beta1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span><span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y1</span> <span class="op">=</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># y2: binomial response</span></span>
<span><span class="va">beta2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">p</span>, min <span class="op">=</span> <span class="fl">0.5</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">beta1</span>  <span class="co"># Shared with group 1</span></span>
<span><span class="va">beta2</span> <span class="op">=</span> <span class="va">beta2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span><span class="op">-</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="co"># Individual</span></span>
<span><span class="va">y2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># y3: survival response</span></span>
<span><span class="va">beta3</span> <span class="op">=</span> <span class="va">beta1</span>  <span class="co"># Shared with group 1</span></span>
<span><span class="va">beta3</span> <span class="op">=</span> <span class="va">beta3</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, max <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span><span class="op">-</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="co"># Individual</span></span>
<span><span class="va">y3.true</span> <span class="op">=</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta3</span><span class="op">)</span></span>
<span><span class="va">y3.cens</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">y3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">y3.true</span>, <span class="va">y3.cens</span><span class="op">)</span>, <span class="va">y3.true</span> <span class="op">&lt;=</span> <span class="va">y3.cens</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split into train and test</span></span>
<span><span class="va">xtest</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">y1test</span> <span class="op">=</span> <span class="va">y1</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">y2test</span> <span class="op">=</span> <span class="va">y2</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">y3test</span> <span class="op">=</span> <span class="va">y3</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span>, <span class="op">]</span></span>
<span><span class="va">y1</span> <span class="op">=</span> <span class="va">y1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span><span class="op">]</span></span>
<span><span class="va">y2</span> <span class="op">=</span> <span class="va">y2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span><span class="op">]</span></span>
<span><span class="va">y3</span> <span class="op">=</span> <span class="va">y3</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Define training folds</span></span>
<span><span class="va">nfolds</span> <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="va">foldid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">trunc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="va">nfolds</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>For the first step of pretraining, train a model for the primary
outcome (<span class="math inline">\(y_1\)</span>) and record the offset
and support – these will be used when training the models for <span class="math inline">\(y_2\)</span> and <span class="math inline">\(y_3\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y1_fit</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y1</span>, keep<span class="op">=</span><span class="cn">TRUE</span>, foldid <span class="op">=</span> <span class="va">foldid</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_offset</span> <span class="op">=</span> <span class="va">y1_fit</span><span class="op">$</span><span class="va">fit.preval</span><span class="op">[</span>, <span class="va">y1_fit</span><span class="op">$</span><span class="va">lambda</span> <span class="op">==</span> <span class="va">y1_fit</span><span class="op">$</span><span class="va">lambda.1se</span><span class="op">]</span></span>
<span><span class="va">support</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">y1_fit</span>, s <span class="op">=</span> <span class="va">y1_fit</span><span class="op">$</span><span class="va">lambda.1se</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Now we have everything we need to train the models for <span class="math inline">\(y_2\)</span> and <span class="math inline">\(y_3\)</span>. In the following code, we loop over
<span class="math inline">\(\alpha = 0, 0.1, \dots, 1\)</span>; in each
step, we (1) train models for <span class="math inline">\(y_2\)</span>
and <span class="math inline">\(y_3\)</span> and (2) record the CV error
from both models. The CV error will be used to determine values of <span class="math inline">\(\alpha\)</span> to use for the final models.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv.error.y2</span> <span class="op">=</span> <span class="va">cv.error.y3</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="va">alphalist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">alpha</span> <span class="kw">in</span> <span class="va">alphalist</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">alpha</span>, <span class="va">p</span><span class="op">)</span></span>
<span>  <span class="va">pf</span><span class="op">[</span><span class="va">support</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>  </span>
<span>  <span class="va">offset</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">)</span> <span class="op">*</span> <span class="va">train_offset</span></span>
<span>    </span>
<span>  <span class="va">y2_fit</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y2</span>, </span>
<span>                     foldid <span class="op">=</span> <span class="va">foldid</span>,</span>
<span>                     offset <span class="op">=</span> <span class="va">offset</span>,</span>
<span>                     penalty.factor <span class="op">=</span> <span class="va">pf</span>,</span>
<span>                     family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                     type.measure <span class="op">=</span> <span class="st">"auc"</span><span class="op">)</span></span>
<span>  <span class="va">cv.error.y2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cv.error.y2</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y2_fit</span><span class="op">$</span><span class="va">cvm</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">y3_fit</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y3</span>, </span>
<span>                     foldid <span class="op">=</span> <span class="va">foldid</span>,</span>
<span>                     offset <span class="op">=</span> <span class="va">offset</span>,</span>
<span>                     penalty.factor <span class="op">=</span> <span class="va">pf</span>,</span>
<span>                     family <span class="op">=</span> <span class="st">"cox"</span>,</span>
<span>                     type.measure <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span></span>
<span>  <span class="va">cv.error.y3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cv.error.y3</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y3_fit</span><span class="op">$</span><span class="va">cvm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Plotting our CV performance suggests the value of <span class="math inline">\(\alpha\)</span> we should choose for each
outcome:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alphalist</span>, <span class="va">cv.error.y2</span>, type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"Outcome 2: CV AUC vs "</span> <span class="op">~</span> <span class="va">alpha</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"CV AUC"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">alphalist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">cv.error.y2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alphalist</span>, <span class="va">cv.error.y3</span>, type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"Outcome 3: CV C index vs "</span> <span class="op">~</span> <span class="va">alpha</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"CV C index"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">alphalist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">cv.error.y3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="MultiResponseMixed_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Now that we have selected our values of <span class="math inline">\(\alpha\)</span>, we can fit the final models for
<span class="math inline">\(y_2\)</span> and <span class="math inline">\(y_3\)</span>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">############################################################</span></span>
<span><span class="co"># Model for y2:</span></span>
<span><span class="co">############################################################</span></span>
<span><span class="va">best.alpha.y2</span> <span class="op">=</span> <span class="va">alphalist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">cv.error.y2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">pf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">best.alpha.y2</span>, <span class="va">p</span><span class="op">)</span>; <span class="va">pf</span><span class="op">[</span><span class="va">support</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">y2_fit</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y2</span>, </span>
<span>                   foldid <span class="op">=</span> <span class="va">foldid</span>,</span>
<span>                   offset <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">best.alpha.y2</span><span class="op">)</span> <span class="op">*</span> <span class="va">train_offset</span>,</span>
<span>                   penalty.factor <span class="op">=</span> <span class="va">pf</span>,</span>
<span>                   family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                   type.measure <span class="op">=</span> <span class="st">"auc"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">############################################################</span></span>
<span><span class="co"># Repeat for y3:</span></span>
<span><span class="co">############################################################</span></span>
<span><span class="va">best.alpha.y3</span> <span class="op">=</span> <span class="va">alphalist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">cv.error.y3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">pf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">best.alpha.y3</span>, <span class="va">p</span><span class="op">)</span>; <span class="va">pf</span><span class="op">[</span><span class="va">support</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">y3_fit</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y3</span>, </span>
<span>                   foldid <span class="op">=</span> <span class="va">foldid</span>,</span>
<span>                   offset <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">best.alpha.y3</span><span class="op">)</span> <span class="op">*</span> <span class="va">train_offset</span>,</span>
<span>                   penalty.factor <span class="op">=</span> <span class="va">pf</span>,</span>
<span>                   family <span class="op">=</span> <span class="st">"cox"</span>, </span>
<span>                   type.measure <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span></span></code></pre></div>
<p>We will also train models for <span class="math inline">\(y_2\)</span> and <span class="math inline">\(y_3\)</span> <em>without</em> pretraining; this is
a natural benchmark.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y2_fit_no_pretrain</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y2</span>, foldid <span class="op">=</span> <span class="va">foldid</span>, </span>
<span>                               family <span class="op">=</span> <span class="st">"binomial"</span>, type.measure <span class="op">=</span> <span class="st">"auc"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y3_fit_no_pretrain</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y3</span>, </span>
<span>                               foldid <span class="op">=</span> <span class="va">foldid</span>, </span>
<span>                               family <span class="op">=</span> <span class="st">"cox"</span>, type.measure <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span></span></code></pre></div>
<p>All of our models have been trained. Let’s compare performance with
and without pretraining; we’ll start with the model for <span class="math inline">\(y_2\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">testoffset</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">y1_fit</span>, <span class="va">xtest</span>, s <span class="op">=</span> <span class="st">"lambda.1se"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Model 2 AUC with pretraining:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/assess.glmnet.html" class="external-link">assess.glmnet</a></span><span class="op">(</span><span class="va">y2_fit</span>, <span class="va">xtest</span>, newy <span class="op">=</span> <span class="va">y2test</span>, </span>
<span>                        newoffset <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">best.alpha.y2</span><span class="op">)</span> <span class="op">*</span> <span class="va">testoffset</span><span class="op">)</span><span class="op">$</span><span class="va">auc</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    fill<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model 2 AUC with pretraining: 0.76</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Model 2 AUC without pretraining:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/assess.glmnet.html" class="external-link">assess.glmnet</a></span><span class="op">(</span><span class="va">y2_fit_no_pretrain</span>, <span class="va">xtest</span>, newy <span class="op">=</span> <span class="va">y2test</span><span class="op">)</span><span class="op">$</span><span class="va">auc</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="co">#&gt; Model 2 AUC without pretraining: 0.66</span></span></code></pre></div>
<p>And now, the models for <span class="math inline">\(y_3\)</span>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Model 3 C-index with pretraining:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/assess.glmnet.html" class="external-link">assess.glmnet</a></span><span class="op">(</span><span class="va">y3_fit</span>, <span class="va">xtest</span>, newy <span class="op">=</span> <span class="va">y3test</span>, </span>
<span>                        newoffset <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">best.alpha.y3</span><span class="op">)</span> <span class="op">*</span> <span class="va">testoffset</span><span class="op">)</span><span class="op">$</span><span class="va">C</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model 3 C-index with pretraining: 0.8</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Model 3 C-index without pretraining:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/assess.glmnet.html" class="external-link">assess.glmnet</a></span><span class="op">(</span><span class="va">y3_fit_no_pretrain</span>, <span class="va">xtest</span>, newy <span class="op">=</span> <span class="va">y3test</span><span class="op">)</span><span class="op">$</span><span class="va">C</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="co">#&gt; Model 3 C-index without pretraining: 0.78</span></span></code></pre></div>
<p>For both <span class="math inline">\(y_2\)</span> and <span class="math inline">\(y_3\)</span>, we saw a performance improvement
using pretraining. We didn’t technically need to train the individual
(non-pretrained) models for <span class="math inline">\(y_2\)</span> and
<span class="math inline">\(y_3\)</span>: during our CV loop to choose
<span class="math inline">\(\alpha\)</span>, we saw the cross validation
performance for the individual models (the special case when <span class="math inline">\(\alpha = 1\)</span>), and CV recommended a smaller
value of <span class="math inline">\(\alpha\)</span> for both
outcomes.</p>
<p>Note that, in this example, we trained a model using <span class="math inline">\(y_1\)</span>, and then used this model to form the
offset and support for the models for <span class="math inline">\(y_2\)</span> and <span class="math inline">\(y_3\)</span> in parallel. But using pretraining
for multi-response data is <em>flexible</em>. Pretraining is simply a
method to pass information from one model to another, and we are free to
choose how information flows. For example, we chose to pass information
from model 1 (<span class="math inline">\(y_1\)</span>) to model 2
(<span class="math inline">\(y_2\)</span>) and to model 3 (<span class="math inline">\(y_3\)</span>). But, we could have instead
<em>chained</em> our models to pass information from model 1 to model 2,
and then from model 2 to model 3 in the following way:</p>
<ol style="list-style-type: decimal">
<li>fit a model for <span class="math inline">\(y_1\)</span>,</li>
<li>extract the offset and support from this model,</li>
<li>use the offset and support (the usual pretraining) to train a model
for <span class="math inline">\(y_2\)</span>,</li>
<li>extract the offset and support from this second model, and</li>
<li>use them to train a model for <span class="math inline">\(y_3\)</span>.</li>
</ol>
<p>In this framework, the model for <span class="math inline">\(y_3\)</span> depends implicitly on both the models
for <span class="math inline">\(y_1\)</span> <em>and</em> <span class="math inline">\(y_2\)</span>, as the offset and support for the
model for <span class="math inline">\(y_2\)</span> were informed by the
model for <span class="math inline">\(y_1\)</span>. Choosing how
information should be passed between outcomes is context specific and we
recommend relying on domain knowledge for selecting an approach (though
many options may be tried and compared with cross-validation or a
validation set).</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="http://www.erincraig.me" class="external-link">Erin Craig</a>, <a href="http://statistics.stanford.edu/people/robert-tibshirani" class="external-link">Rob Tibshirani</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
