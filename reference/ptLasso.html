<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='Fits a pretrained lasso model using the glmnet package, for a fixed choice of the pretraining hyperparameter alpha. Additionally fits an "overall" model (using all data) and "individual" models (use each individual group). Can fit input-grouped data with Gaussian, multinomial, binomial or Cox outcomes, and target-grouped data, which necessarily has a multinomial outcome. Many ptLasso arguments are passed directly to glmnet, and therefore the glmnet documentation is another good reference for ptLasso.'><title>Fit a pretrained lasso model using glmnet. — ptLasso • ptLasso</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a pretrained lasso model using glmnet. — ptLasso"><meta property="og:description" content='Fits a pretrained lasso model using the glmnet package, for a fixed choice of the pretraining hyperparameter alpha. Additionally fits an "overall" model (using all data) and "individual" models (use each individual group). Can fit input-grouped data with Gaussian, multinomial, binomial or Cox outcomes, and target-grouped data, which necessarily has a multinomial outcome. Many ptLasso arguments are passed directly to glmnet, and therefore the glmnet documentation is another good reference for ptLasso.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ptLasso</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/ptLasso.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/DifferentGroupsTrainAndTest.html">Different groups in train and test data</a>
    <a class="dropdown-item" href="../articles/LearningTheInputGroups.html">Learning the input groups</a>
    <a class="dropdown-item" href="../articles/MultitaskLearning.html">Multitask learning or coaching</a>
    <a class="dropdown-item" href="../articles/MultiResponseData.html">Multi-response data with mixed response types</a>
    <a class="dropdown-item" href="../articles/TimeSeriesData.html">Time series</a>
    <a class="dropdown-item" href="../articles/UsingNonlinearBases.html">Pretraining with nonlinear bases</a>
    <a class="dropdown-item" href="../articles/UnsupervisedPretraining.html">Unsupervised pretraining</a>
    <a class="dropdown-item" href="../articles/ConditionalAverageTreatmentEffect.html">Conditional average treatment effects</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fit a pretrained lasso model using glmnet.</h1>
      
      <div class="d-none name"><code>ptLasso.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits a pretrained lasso model using the glmnet package, for a fixed choice of the pretraining hyperparameter alpha. Additionally fits an "overall" model (using all data) and "individual" models (use each individual group). Can fit input-grouped data with Gaussian, multinomial, binomial or Cox outcomes, and target-grouped data, which necessarily has a multinomial outcome. Many ptLasso arguments are passed directly to glmnet, and therefore the glmnet documentation is another good reference for ptLasso.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ptLasso</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">groups</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="st">"multinomial"</span>, <span class="st">"binomial"</span>, <span class="st">"cox"</span><span class="op">)</span>,</span>
<span>  type.measure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"default"</span>, <span class="st">"mse"</span>, <span class="st">"mae"</span>, <span class="st">"auc"</span>, <span class="st">"deviance"</span>, <span class="st">"class"</span>, <span class="st">"C"</span><span class="op">)</span>,</span>
<span>  use.case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"inputGroups"</span>, <span class="st">"targetGroups"</span>, <span class="st">"multiresponse"</span><span class="op">)</span>,</span>
<span>  overall.lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda.1se"</span>, <span class="st">"lambda.min"</span><span class="op">)</span>,</span>
<span>  overall.gamma <span class="op">=</span> <span class="st">"gamma.1se"</span>,</span>
<span>  foldid <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nfolds <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  penalty.factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nvars</span><span class="op">)</span>,</span>
<span>  fitoverall <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fitind <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  en.alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  group.intercepts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>input matrix, of dimension nobs x nvars; each row is an observation vector. Can be in sparse matrix format (inherit from class '"sparseMatrix"' as in package 'Matrix'). Requirement: 'nvars &gt;1'; in other words, 'x' should have 2 or more columns.</p></dd>


<dt>y</dt>
<dd><p>response variable. Quantitative for 'family="gaussian"'. For 'family="binomial"' should be either a factor with two levels, or a two-column matrix of counts or proportions (the second column is treated as the target class; for a factor, the last level in alphabetical order is the target class). For 'family="multinomial"', can be a 'nc&gt;=2' level factor, or a matrix with 'nc' columns of counts or proportions. For either '"binomial"' or '"multinomial"', if 'y' is presented as a vector, it will be coerced into a factor. For 'family="cox"', preferably a 'Surv' object from the survival package: see Detail section for more information. For 'use.case = "multiresponse", 'y' is a matrix of quantitative responses.</p></dd>


<dt>groups</dt>
<dd><p>A vector of length nobs indicating to which group each observation belongs. Only for 'use.case = "inputGroups"'.</p></dd>


<dt>alpha</dt>
<dd><p>The pretrained lasso hyperparameter, with \(0\le\alpha\le 1\). The range of alpha is from 0 (which fits the overall model with fine tuning) to 1 (the individual models). The default value is 0.5, chosen mostly at random. To choose the appropriate value for your data, please either run <code>ptLasso</code> with a few choices of alpha and evaluate with a validation set, or use cv.ptLasso, which recommends a value of alpha using cross validation.</p></dd>


<dt>family</dt>
<dd><p>Either a character string representing one of the built-in families, or else a 'glm()' family object. For more information, see Details section below or the documentation for response type (above).</p></dd>


<dt>type.measure</dt>
<dd><p>loss to use for cross-validation within each individual, overall, or pretrained lasso model. Currently five options, not all available for all models. The default is 'type.measure="deviance"', which uses squared-error for gaussian models (a.k.a 'type.measure="mse"' there), deviance for logistic and poisson regression, and partial-likelihood for the Cox model. 'type.measure="class"' applies to binomial and multinomial logistic regression only, and gives misclassification error. 'type.measure="auc"' is for two-class logistic regression only, and gives area under the ROC curve. 'type.measure="mse"' or 'type.measure="mae"' (mean absolute error) can be used by all models except the '"cox"'; they measure the deviation from the fitted mean to the response. 'type.measure="C"' is Harrel's concordance measure, only available for 'cox' models.</p></dd>


<dt>use.case</dt>
<dd><p>The type of grouping observed in the data. Can be one of "inputGroups", "targetGroups" or "multiresponse".</p></dd>


<dt>overall.lambda</dt>
<dd><p>The choice of lambda to be used by the overall model to define the offset and penalty factor for pretrained lasso. Defaults to "lambda.1se", could alternatively be "lambda.min". This choice of lambda will be used to compute the offset and penalty factor (1) during model training and (2) during prediction. In the predict function, another lambda must be specified for the individual models, the second stage of pretraining and the overall model.</p></dd>


<dt>overall.gamma</dt>
<dd><p>For use only when the option <code>relax = TRUE</code> is specified. The choice of gamma to be used by the overall model to define the offset and penalty factor for pretrained lasso. Defaults to "gamma.1se", but "gamma.min" is also a good option. This choice of gamma will be used to compute the offset and penalty factor (1) during model training and (2) during prediction. In the predict function, another gamma must be specified for the individual models, the second stage of pretraining and the overall model.</p></dd>


<dt>foldid</dt>
<dd><p>An optional vector of values between 1 and <code>nfolds</code> identifying what fold each observation is in. If supplied, <code>nfold</code> can be missing.</p></dd>


<dt>nfolds</dt>
<dd><p>Number of folds for CV (default is 10). Although <code>nfolds</code>can be as large as the sample size (leave-one-out CV), it is not recommended for large datasets. Smallest value allowable is <code>nfolds = 3</code>.</p></dd>


<dt>standardize</dt>
<dd><p>Should the predictors be standardized before fitting (default is TRUE).</p></dd>


<dt>verbose</dt>
<dd><p>If <code>verbose=1</code>, print a statement showing which model is currently being fit with <code>cv.glmnet</code>.</p></dd>


<dt>weights</dt>
<dd><p>observation weights. Default is 1 for each observation.</p></dd>


<dt>penalty.factor</dt>
<dd><p>Separate penalty factors can be applied to each coefficient. This is a number that multiplies 'lambda' to allow differential shrinkage. Can be 0 for some variables,  which implies no shrinkage, and that variable is always included in the model. Default is 1 for all variables (and implicitly infinity for variables listed in 'exclude'). For more information, see <code>?glmnet</code>. For pretraining, the user-supplied penalty.factor will be multiplied by the penalty.factor computed by the overall model.</p></dd>


<dt>fitoverall</dt>
<dd><p>An optional cv.glmnet object specifying the overall model. This should have been trained on the full training data, with the argument 'keep = TRUE'.</p></dd>


<dt>fitind</dt>
<dd><p>An optional list of cv.glmnet objects specifying the individual models. These should have been trained on the original training data, with the argument 'keep = TRUE'.</p></dd>


<dt>en.alpha</dt>
<dd><p>The elasticnet mixing parameter, with 0 &lt;= en.alpha &lt;= 1. The penalty is defined as (1-alpha)/2||beta||_2^2+alpha||beta||_1. 'alpha=1' is the lasso penalty, and 'alpha=0' the ridge penalty. Default is `en.alpha = 1` (lasso).</p></dd>


<dt>group.intercepts</dt>
<dd><p>For 'use.case = "inputGroups"' only. If `TRUE`, fit the overall model with a separate intercept for each group. If `FALSE`, ignore the grouping and fit one overall intercept. Default is `TRUE`.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments to be passed to the cv.glmnet functions. Notable choices include <code>"trace.it"</code> and <code>"parallel"</code>. If <code>trace.it = TRUE</code>, then a progress bar is displayed for each call to <code>"cv.glmnet"</code>; useful for big models that take a long time to fit. If <code>parallel = TRUE</code>, use parallel <code>foreach</code> to fit each fold.  Must register parallel before hand, such as <code>doMC</code> or others. ptLasso does not support the arguments <code>intercept</code>, <code>offset</code>, <code>fit</code> and <code>check.args</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class <code>"ptLasso"</code>, which is a list with the ingredients of the fitted models.</p>
<dl><dt>call</dt>
<dd><p>The call that produced this object.</p></dd>

<dt>k</dt>
<dd><p>The number of groups.</p></dd>

<dt>alpha</dt>
<dd><p>The value of alpha used for pretraining.</p></dd>

<dt>group.levels</dt>
<dd><p>IDs for all of the groups used in training.</p></dd>

<dt>group.legend</dt>
<dd><p>Mapping from user-supplied group ids to numeric group ids. For internal use (e.g. with predict).</p></dd>

<dt>fitoverall</dt>
<dd><p>A fitted <code>cv.glmnet</code> object trained using the full data.</p></dd>

<dt>fitpre</dt>
<dd><p>A list of fitted (pretrained) <code>cv.glmnet</code> objects, one trained with each data group.</p></dd>

<dt>fitind</dt>
<dd><p>A list of fitted <code>cv.glmnet</code> objects, one trained with each group.</p></dd>

<dt>fitoverall.lambda</dt>
<dd><p>Lambda used with fitoverall, to compute the offset for pretraining.</p></dd>

<dt>fitoverall.gamma</dt>
<dd><p>Gamma used with fitoverall when 'relax = TRUE', to compute the offset for pretraining.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Friedman, J., Hastie, T., &amp; Tibshirani, R. (2010). Regularization paths for generalized linear models via coordinate descent. Journal of Statistical Software, 33(1), 1-22.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>glmnet</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Getting started. First, we simulate data: we need covariates x, response y and group IDs.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">*</span><span class="fl">20</span><span class="op">)</span>, <span class="fl">1000</span>, <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">groups</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xtest</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">*</span><span class="fl">20</span><span class="op">)</span>, <span class="fl">1000</span>, <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ytest</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">groupstest</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now, we can fit a ptLasso model:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu">ptLasso</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, groups <span class="op">=</span> <span class="va">groups</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot(fit) # to see all of the cv.glmnet models trained</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">xtest</span>, <span class="va">groupstest</span><span class="op">)</span> <span class="co"># to predict on new data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> predict.ptLasso(object = fit, xtest = xtest, groupstest = groupstest) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alpha =  0.5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Support size:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall    3                          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pretrain   9 (0 common + 9 individual)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Individual 9                          </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">xtest</span>, <span class="va">groupstest</span>, ytest<span class="op">=</span><span class="va">ytest</span><span class="op">)</span> <span class="co"># if ytest is included, we also measure performance</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> predict.ptLasso(object = fit, xtest = xtest, groupstest = groupstest,  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ytest = ytest) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alpha =  0.5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Performance (Mean squared error):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            allGroups  mean group_1 group_2 group_3 group_4 group_5       r^2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall        1.141 1.141   1.098   1.136   1.313   1.043   1.115 -0.003342</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pretrain       1.149 1.149   1.100   1.182   1.308   1.041   1.116 -0.010747</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Individual     1.149 1.149   1.100   1.182   1.308   1.041   1.116 -0.010818</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Support size:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall    3                          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pretrain   9 (0 common + 9 individual)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Individual 9                          </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># When we trained our model, we used "lambda.1se" in the first stage of pretraining by default.</span></span></span>
<span class="r-in"><span><span class="co"># This is a necessary choice to make during model training; we need to select the model</span></span></span>
<span class="r-in"><span><span class="co"># we want to use to define the offset and penalty factor for the second stage of pretraining.</span></span></span>
<span class="r-in"><span><span class="co"># We could instead have used "lambda.min":</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu">ptLasso</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, groups <span class="op">=</span> <span class="va">groups</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span>,</span></span>
<span class="r-in"><span>              overall.lambda <span class="op">=</span> <span class="st">"lambda.min"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can use the 'relax' option to fit relaxed lasso models:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu">ptLasso</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, groups <span class="op">=</span> <span class="va">groups</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>              family <span class="op">=</span> <span class="st">"gaussian"</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span>,</span></span>
<span class="r-in"><span>              relax <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># As we did for lambda, we may want to specify the choice of gamma for stage one</span></span></span>
<span class="r-in"><span><span class="co"># of pretraining. (The default is "gamma.1se".)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu">ptLasso</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, groups <span class="op">=</span> <span class="va">groups</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>              family <span class="op">=</span> <span class="st">"gaussian"</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span>,</span></span>
<span class="r-in"><span>              relax <span class="op">=</span> <span class="cn">TRUE</span>, overall.gamma <span class="op">=</span> <span class="st">"gamma.min"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># In practice, we may want to try many values of alpha.</span></span></span>
<span class="r-in"><span><span class="co"># alpha may range from 0 (the overall model with fine tuning) to 1 (the individual models).</span></span></span>
<span class="r-in"><span><span class="co"># To choose alpha, you may either (1) run ptLasso with different values of alpha</span></span></span>
<span class="r-in"><span><span class="co"># and measure performance with a validation set, or (2) use cv.ptLasso.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now, we are ready to simulate slightly more realistic data.</span></span></span>
<span class="r-in"><span><span class="co"># This continuous outcome example has k = 5 groups, where each group has 200 observations.</span></span></span>
<span class="r-in"><span><span class="co"># There are scommon = 10 features shared across all groups, and</span></span></span>
<span class="r-in"><span><span class="co"># sindiv = 10 features unique to each group.</span></span></span>
<span class="r-in"><span><span class="co"># n = 1000 and p = 120 (60 informative features and 60 noise features).</span></span></span>
<span class="r-in"><span><span class="co"># The coefficients of the common features differ across groups (beta.common).</span></span></span>
<span class="r-in"><span><span class="co"># In group 1, these coefficients are rep(1, 10); in group 2 they are rep(2, 10), etc.</span></span></span>
<span class="r-in"><span><span class="co"># Each group has 10 unique features, the coefficients of which are all 3 (beta.indiv).</span></span></span>
<span class="r-in"><span><span class="co"># The intercept in all groups is 0.</span></span></span>
<span class="r-in"><span><span class="co"># The variable sigma = 20 indicates that we add noise to y according to 20 * rnorm(n). </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">k</span><span class="op">=</span><span class="fl">5</span></span></span>
<span class="r-in"><span><span class="va">class.sizes</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">200</span>, <span class="va">k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">scommon</span><span class="op">=</span><span class="fl">10</span>; <span class="va">sindiv</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">class.sizes</span><span class="op">)</span>; <span class="va">p</span><span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sindiv</span><span class="op">)</span> <span class="op">+</span> <span class="va">scommon</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">beta.common</span><span class="op">=</span><span class="fl">3</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span>; <span class="va">beta.indiv</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">intercepts</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sigma</span><span class="op">=</span><span class="fl">20</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="gaussian.example.data.html">gaussian.example.data</a></span><span class="op">(</span>k<span class="op">=</span><span class="va">k</span>, class.sizes<span class="op">=</span><span class="va">class.sizes</span>,</span></span>
<span class="r-in"><span>                            scommon<span class="op">=</span><span class="va">scommon</span>, sindiv<span class="op">=</span><span class="va">sindiv</span>,</span></span>
<span class="r-in"><span>                            n<span class="op">=</span><span class="va">n</span>, p<span class="op">=</span><span class="va">p</span>,</span></span>
<span class="r-in"><span>                            beta.common<span class="op">=</span><span class="va">beta.common</span>, beta.indiv<span class="op">=</span><span class="va">beta.indiv</span>,</span></span>
<span class="r-in"><span>                            intercepts<span class="op">=</span><span class="va">intercepts</span>, sigma<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">x</span>; <span class="va">y</span><span class="op">=</span><span class="va">out</span><span class="op">$</span><span class="va">y</span>; <span class="va">groups</span> <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">group</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">outtest</span> <span class="op">=</span> <span class="fu"><a href="gaussian.example.data.html">gaussian.example.data</a></span><span class="op">(</span>k<span class="op">=</span><span class="va">k</span>, class.sizes<span class="op">=</span><span class="va">class.sizes</span>,</span></span>
<span class="r-in"><span>                                scommon<span class="op">=</span><span class="va">scommon</span>, sindiv<span class="op">=</span><span class="va">sindiv</span>,</span></span>
<span class="r-in"><span>                                n<span class="op">=</span><span class="va">n</span>, p<span class="op">=</span><span class="va">p</span>,</span></span>
<span class="r-in"><span>                                beta.common<span class="op">=</span><span class="va">beta.common</span>, beta.indiv<span class="op">=</span><span class="va">beta.indiv</span>,</span></span>
<span class="r-in"><span>                                intercepts<span class="op">=</span><span class="va">intercepts</span>, sigma<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xtest</span><span class="op">=</span><span class="va">outtest</span><span class="op">$</span><span class="va">x</span>; <span class="va">ytest</span><span class="op">=</span><span class="va">outtest</span><span class="op">$</span><span class="va">y</span>; <span class="va">groupstest</span><span class="op">=</span><span class="va">outtest</span><span class="op">$</span><span class="va">groups</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu">ptLasso</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, groups <span class="op">=</span> <span class="va">groups</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot(fit) to see all of the cv.glmnet models trained</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">xtest</span>, <span class="va">groupstest</span>, ytest<span class="op">=</span><span class="va">ytest</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> predict.ptLasso(object = fit, xtest = xtest, groupstest = groupstest,  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ytest = ytest) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alpha =  0.5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Performance (Mean squared error):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            allGroups  mean group_1 group_2 group_3 group_4 group_5    r^2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall        755.7 755.7   836.0   554.9   565.4   777.9  1044.0 0.5371</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pretrain       503.2 503.2   550.6   443.3   553.5   505.6   462.9 0.6918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Individual     532.8 532.8   584.1   443.2   567.2   550.5   518.9 0.6736</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Support size:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall    64                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pretrain   94 (21 common + 73 individual)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Individual 109                           </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now, we repeat with a binomial outcome.</span></span></span>
<span class="r-in"><span><span class="co"># This example has k = 3 groups, where each group has 100 observations.</span></span></span>
<span class="r-in"><span><span class="co"># There are scommon = 5 features shared across all groups, and</span></span></span>
<span class="r-in"><span><span class="co"># sindiv = 5 features unique to each group.</span></span></span>
<span class="r-in"><span><span class="co"># n = 300 and p = 40 (20 informative features and 20 noise features).</span></span></span>
<span class="r-in"><span><span class="co"># The coefficients of the common features differ across groups (beta.common),</span></span></span>
<span class="r-in"><span><span class="co"># as do the coefficients specific to each group (beta.indiv).</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">k</span><span class="op">=</span><span class="fl">3</span></span></span>
<span class="r-in"><span><span class="va">class.sizes</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">scommon</span><span class="op">=</span><span class="fl">5</span>; <span class="va">sindiv</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">class.sizes</span><span class="op">)</span>; <span class="va">p</span><span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sindiv</span><span class="op">)</span> <span class="op">+</span> <span class="va">scommon</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">beta.common</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.5</span>, <span class="fl">.5</span>, <span class="fl">.3</span>, <span class="op">-</span><span class="fl">.9</span>, <span class="fl">.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.3</span>, <span class="fl">.9</span>, <span class="fl">.1</span>, <span class="op">-</span><span class="fl">.1</span>, <span class="fl">.2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">.2</span>, <span class="op">-</span><span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">.3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">beta.indiv</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">k</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>  <span class="fl">0.9</span> <span class="op">*</span> <span class="va">beta.common</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="binomial.example.data.html">binomial.example.data</a></span><span class="op">(</span>k<span class="op">=</span><span class="va">k</span>, class.sizes<span class="op">=</span><span class="va">class.sizes</span>,</span></span>
<span class="r-in"><span>                            scommon<span class="op">=</span><span class="va">scommon</span>, sindiv<span class="op">=</span><span class="va">sindiv</span>,</span></span>
<span class="r-in"><span>                            n<span class="op">=</span><span class="va">n</span>, p<span class="op">=</span><span class="va">p</span>,</span></span>
<span class="r-in"><span>                            beta.common<span class="op">=</span><span class="va">beta.common</span>, beta.indiv<span class="op">=</span><span class="va">beta.indiv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">x</span>; <span class="va">y</span><span class="op">=</span><span class="va">out</span><span class="op">$</span><span class="va">y</span>; <span class="va">groups</span> <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">group</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">outtest</span> <span class="op">=</span> <span class="fu"><a href="binomial.example.data.html">binomial.example.data</a></span><span class="op">(</span>k<span class="op">=</span><span class="va">k</span>, class.sizes<span class="op">=</span><span class="va">class.sizes</span>,</span></span>
<span class="r-in"><span>                                scommon<span class="op">=</span><span class="va">scommon</span>, sindiv<span class="op">=</span><span class="va">sindiv</span>,</span></span>
<span class="r-in"><span>                                n<span class="op">=</span><span class="va">n</span>, p<span class="op">=</span><span class="va">p</span>,</span></span>
<span class="r-in"><span>                                beta.common<span class="op">=</span><span class="va">beta.common</span>, beta.indiv<span class="op">=</span><span class="va">beta.indiv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xtest</span><span class="op">=</span><span class="va">outtest</span><span class="op">$</span><span class="va">x</span>; <span class="va">ytest</span><span class="op">=</span><span class="va">outtest</span><span class="op">$</span><span class="va">y</span>; <span class="va">groupstest</span><span class="op">=</span><span class="va">outtest</span><span class="op">$</span><span class="va">groups</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu">ptLasso</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, groups <span class="op">=</span> <span class="va">groups</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot(fit) to see all of the cv.glmnet models trained</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">xtest</span>, <span class="va">groupstest</span>, ytest<span class="op">=</span><span class="va">ytest</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> predict.ptLasso(object = fit, xtest = xtest, groupstest = groupstest,  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ytest = ytest) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alpha =  0.5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Performance (Mean squared error):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            allGroups   mean group_1 group_2 group_3     r^2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall       0.2432 0.2432  0.2371  0.2341  0.2584 0.02687</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pretrain      0.2374 0.2374  0.2603  0.1991  0.2527 0.05022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Individual    0.2414 0.2414  0.2681  0.2028  0.2532 0.03415</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Support size:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall    7                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pretrain   29 (3 common + 26 individual)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Individual 29                           </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now let's consider the case of a multiresponse outcome. We'll start by simulating data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">1000</span>; <span class="va">ntrain</span> <span class="op">=</span> <span class="fl">500</span>;</span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">=</span> <span class="fl">500</span></span></span>
<span class="r-in"><span><span class="va">sigma</span> <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span>     </span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">beta1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">beta2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span> <span class="op">-</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mu</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta1</span>, <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">sigma</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>           <span class="va">mu</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">sigma</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"SNR for the two tasks:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">-</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, fill<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SNR for the two tasks: 1.6 1.44</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Correlation between two tasks:"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, fill<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Correlation between two tasks: 0.5164748</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xtest</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">ytest</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">ntrain</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now, we can fit a ptLasso multiresponse model:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="cv.ptLasso.html">cv.ptLasso</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span>, use.case <span class="op">=</span> <span class="st">"multiresponse"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot(fit) # to see the cv curve.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">xtest</span><span class="op">)</span> <span class="co"># to predict on new data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> predict.cv.ptLasso(object = fit, xtest = xtest) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alpha =  0.2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Support size:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall    57                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pretrain   23 (19 common + 4 individual)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Individual 80                           </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">xtest</span>, ytest<span class="op">=</span><span class="va">ytest</span><span class="op">)</span> <span class="co"># if ytest is included, we also measure performance</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> predict.cv.ptLasso(object = fit, xtest = xtest, ytest = ytest) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alpha =  0.2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Performance (Mean squared error):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            allGroups  mean response_1 response_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall        9.394 4.697      4.227      5.168</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pretrain       8.907 4.453      4.186      4.721</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Individual     9.465 4.733      4.243      5.222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Support size:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall    57                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pretrain   23 (19 common + 4 individual)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Individual 80                           </span>
<span class="r-in"><span><span class="co"># By default, we used s = "lambda.min" to compute CV performance.</span></span></span>
<span class="r-in"><span><span class="co"># We could instead use s = "lambda.1se":</span></span></span>
<span class="r-in"><span><span class="va">cvfit</span> <span class="op">=</span> <span class="fu"><a href="cv.ptLasso.html">cv.ptLasso</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span>, s <span class="op">=</span> <span class="st">"lambda.1se"</span>, use.case <span class="op">=</span> <span class="st">"multiresponse"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We could also use the glmnet option relax = TRUE:</span></span></span>
<span class="r-in"><span><span class="va">cvfit</span> <span class="op">=</span> <span class="fu"><a href="cv.ptLasso.html">cv.ptLasso</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span>, relax <span class="op">=</span> <span class="cn">TRUE</span>, use.case <span class="op">=</span> <span class="st">"multiresponse"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># And, as we did with lambda, we may want to specify the choice of gamma to compute CV performance:</span></span></span>
<span class="r-in"><span><span class="va">cvfit</span> <span class="op">=</span> <span class="fu"><a href="cv.ptLasso.html">cv.ptLasso</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span>, relax <span class="op">=</span> <span class="cn">TRUE</span>, gamma <span class="op">=</span> <span class="st">"gamma.1se"</span>, use.case <span class="op">=</span> <span class="st">"multiresponse"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">### Model fitting with parallel = TRUE</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">doMC</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">registerDoMC</span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu">ptLasso</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, groups <span class="op">=</span> <span class="va">groups</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, type.measure <span class="op">=</span> <span class="st">"mse"</span>, parallel<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="http://www.erincraig.me" class="external-link">Erin Craig</a>, <a href="http://statistics.stanford.edu/people/robert-tibshirani" class="external-link">Rob Tibshirani</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

